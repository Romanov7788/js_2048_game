var e={};class t{static gameStatuses={idle:"idle",playing:"playing",lose:"lose",win:"win"};constructor(e=[[0,0,0,0],[0,0,0,0],[0,0,0,0],[0,0,0,0]]){this.board=e||this.createEmptyBoard(),this.score=0,this.status=t.gameStatuses.idle}saveBoardState(){return JSON.parse(JSON.stringify(this.board))}hasBoardChanged(e,t){for(let s=0;s<e.length;s++)for(let a=0;a<e[s].length;a++)if(e[s][a]!==t[s][a])return!0;return!1}addCells(e=1){for(let t=0;t<e;t++)this.addRandomTitle()}initializeGame(e=""){this.board=this.createEmptyBoard(),this.score=0,this.addCells(2),this.updateScoreDisplay(),this.showMessage(e)}updateScoreDisplay(){let e=document.querySelector(".game-score");e&&(e.textContent=this.score)}createEmptyBoard(){return[,,,,].fill(null).map(()=>[,,,,].fill(0))}updateBoardDisplay(){let{board:e}=this;document.querySelectorAll(".field-cell").forEach((t,s)=>{let a=Math.floor(s/4),r=s%4;t.textContent=0===e[a][r]?"":e[a][r],t.className="field-cell",0!==e[a][r]&&t.classList.add(`tile-${e[a][r]}`)})}addRandomTitle(){let e=[];for(let t=0;t<4;t++)for(let s=0;s<4;s++)0===this.board[t][s]&&e.push([t,s]);if(0===e.length)return;let[t,s]=e[Math.floor(Math.random()*e.length)];this.board[t][s]=.9>Math.random()?2:4,this.updateBoardDisplay()}moveLeft(){let{board:e}=this,t=this.saveBoardState(),s=Array.from({length:4},()=>[,,,,].fill(0)),a=0;for(let t=0;t<4;t++){let r=0;for(let o=0;o<4;o++)0!==e[t][o]&&(s[t][r]===e[t][o]?(s[t][r]*=2,a+=s[t][r],r++):(0===s[t][r]||r++,s[t][r]=e[t][o]))}return this.score+=a,this.board=s,this.hasBoardChanged(t,this.board)&&this.addRandomTitle(),this.updateBoardDisplay(),this.updateScoreDisplay(),this.score}moveRight(){let{board:e}=this,t=this.saveBoardState(),s=Array.from({length:4},()=>[,,,,].fill(0)),a=0;for(let t=0;t<4;t++){let r=3;for(let o=3;o>=0;o--)0!==e[t][o]&&(s[t][r]===e[t][o]?(s[t][r]*=2,a+=s[t][r],r--):(0===s[t][r]||r--,s[t][r]=e[t][o]))}return this.score+=a,this.board=s,this.hasBoardChanged(t,this.board)&&this.addRandomTitle(),this.updateScoreDisplay(),this.score}moveUp(){let{board:e}=this,t=this.saveBoardState(),s=Array.from({length:4},()=>[,,,,].fill(0)),a=0;for(let t=0;t<4;t++){let r=0;for(let o=0;o<4;o++)0!==e[o][t]&&(s[r][t]===e[o][t]?(s[r][t]*=2,a+=s[r][t],r++):0===s[r][t]?s[r][t]=e[o][t]:s[++r][t]=e[o][t])}return this.score+=a,this.board=s,this.hasBoardChanged(t,this.board)&&this.addRandomTitle(),this.updateScoreDisplay(),this.score}moveDown(){let{board:e}=this,t=this.saveBoardState(),s=Array.from({length:4},()=>[,,,,].fill(0)),a=0;for(let t=0;t<4;t++){let r=3;for(let o=3;o>=0;o--)0!==e[o][t]&&(s[r][t]===e[o][t]?(s[r][t]*=2,a+=s[r][t],r--):0===s[r][t]?s[r][t]=e[o][t]:s[--r][t]=e[o][t])}return this.score+=a,this.board=s,this.hasBoardChanged(t,this.board)&&this.addRandomTitle(),this.updateScoreDisplay(),this.score}checkWin(){for(let e=0;e<4;e++)for(let s=0;s<4;s++)if(2048===this.board[e][s])return this.showMessage(t.gameStatuses.win),!0;return!1}checkLose(){for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(0===this.board[e][t])return!1;for(let e=0;e<4;e++)for(let t=0;t<4;t++)if(e<3&&this.board[e][t]===this.board[e+1][t]||t<3&&this.board[e][t]===this.board[e][t+1])return!1;return this.showMessage(t.gameStatuses.lose),!0}getScore(){return this.score}getState(){return this.board}getStatus(){return this.checkWin()?t.gameStatuses.win:this.checkLose()?t.gameStatuses.lose:this.status}start(){this.status=t.gameStatuses.playing,this.initializeGame("start")}restart(){this.status=t.gameStatuses.idle,this.initializeGame("Game restarted")}showMessage(e){let s=document.querySelector(".message-container");s&&(s.querySelector(".message-start").classList.add("hidden"),s.querySelector(".message-lose").classList.add("hidden"),s.querySelector(".message-win").classList.add("hidden")),e===t.gameStatuses.win?s.querySelector(".message-win").classList.remove("hidden"):e===t.gameStatuses.lose&&s.querySelector(".message-lose").classList.remove("hidden")}}const s=new(e=t),a=document.getElementById("startButton"),r=document.getElementById("restartButton");function o(){s.start(),document.querySelectorAll(".field-cell").forEach(e=>{e.textContent=""}),n(s.board),i(s.board),a.style.display="none",r.style.display="block"}function i(e){document.querySelectorAll(".field-cell").forEach((t,s)=>{let a=e[Math.floor(s/4)][s%4];t.textContent=0===a?"":a}),l()}function l(){let t=s.getStatus();(t===e.gameStatuses.win||t===e.gameStatuses.lose)&&document.removeEventListener("keydown",d)}function d(t){let a={ArrowLeft:()=>s.moveLeft(),ArrowRight:()=>s.moveRight(),ArrowUp:()=>s.moveUp(),ArrowDown:()=>s.moveDown()}[t.key];a&&(a(),s.checkWin()?l(e.gameStatuses.win):s.checkLose()&&l(e.gameStatuses.lose),n(s.board),i(s.board))}function n(e){document.querySelectorAll(".field-row").forEach((t,s)=>{Array.from(t.children).forEach((t,a)=>{let r=e[s][a];t.className="field-cell field-cell--"+r,t.innerText=r>0?r:""})})}document.addEventListener("keydown",d),r.style.display="none",a.addEventListener("click",()=>{o()}),r.addEventListener("click",()=>{s.restart(),o(),document.addEventListener("keydown",d)});
//# sourceMappingURL=index.f0b3250e.js.map
